(function(global,exports,perf){function fixSetTarget(param){if(!param){return}if(!param.setTargetAtTime){param.setTargetAtTime=param.setTargetValueAtTime}}if(window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")){window.AudioContext=webkitAudioContext;if(!AudioContext.prototype.hasOwnProperty("createGain")){AudioContext.prototype.createGain=AudioContext.prototype.createGainNode}if(!AudioContext.prototype.hasOwnProperty("createDelay")){AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode}if(!AudioContext.prototype.hasOwnProperty("createScriptProcessor")){AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode}AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain;AudioContext.prototype.createGain=function(){var node=this.internal_createGain();fixSetTarget(node.gain);return node};AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay;AudioContext.prototype.createDelay=function(maxDelayTime){var node=maxDelayTime?this.internal_createDelay(maxDelayTime):this.internal_createDelay();fixSetTarget(node.delayTime);return node};AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource;AudioContext.prototype.createBufferSource=function(){var node=this.internal_createBufferSource();if(!node.start){node.start=function(when,offset,duration){if(offset||duration){this.noteGrainOn(when,offset,duration)}else{this.noteOn(when)}}}if(!node.stop){node.stop=node.noteOff}fixSetTarget(node.playbackRate);return node};AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor;AudioContext.prototype.createDynamicsCompressor=function(){var node=this.internal_createDynamicsCompressor();fixSetTarget(node.threshold);fixSetTarget(node.knee);fixSetTarget(node.ratio);fixSetTarget(node.reduction);fixSetTarget(node.attack);fixSetTarget(node.release);return node};AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter;AudioContext.prototype.createBiquadFilter=function(){var node=this.internal_createBiquadFilter();fixSetTarget(node.frequency);fixSetTarget(node.detune);fixSetTarget(node.Q);fixSetTarget(node.gain);return node};if(AudioContext.prototype.hasOwnProperty("createOscillator")){AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator;AudioContext.prototype.createOscillator=function(){var node=this.internal_createOscillator();if(!node.start){node.start=node.noteOn}if(!node.stop){node.stop=node.noteOff}fixSetTarget(node.frequency);fixSetTarget(node.detune);return node}}}}(window));(function(doc){var pollute=true,api,vendor,apis={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",events:{change:"fullscreenchange",error:"fullscreenerror"}},webkit:{enabled:"webkitIsFullScreen",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen",exit:"webkitCancelFullScreen",events:{change:"webkitfullscreenchange",error:"webkitfullscreenerror"}},moz:{enabled:"mozFullScreen",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",events:{change:"mozfullscreenchange",error:"mozfullscreenerror"}},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",events:{change:"MSFullscreenChange",error:"MSFullscreenError"}}},w3=apis.w3;for(vendor in apis){if(apis[vendor].enabled in doc){api=apis[vendor];break}}function dispatch(type,target){var event=doc.createEvent("Event");event.initEvent(type,true,false);target.dispatchEvent(event)}function handleChange(e){doc[w3.enabled]=doc[api.enabled];doc[w3.element]=doc[api.element];dispatch(w3.events.change,e.target)}function handleError(e){dispatch(w3.events.error,e.target)}if(pollute&&!(w3.enabled in doc)&&api){doc.addEventListener(api.events.change,handleChange,false);doc.addEventListener(api.events.error,handleError,false);doc[w3.enabled]=doc[api.enabled];doc[w3.element]=doc[api.element];doc[w3.exit]=doc[api.exit];Element.prototype[w3.request]=function(){return this[api.request].apply(this,arguments)}}return api}(document));GA=GA||{};GA.plugins=function(ga){ga.move=function(sprites){if(sprites instanceof Array===false){internal_move(sprites)}else{for(var i=0;i<sprites.length;i++){internal_move(sprites[i])}}};function internal_move(sprite){sprite.x+=sprite.vx|0;sprite.y+=sprite.vy|0}ga.distance=function(s1,s2){var vx=s2.centerX-s1.centerX,vy=s2.centerY-s1.centerY;return Math.sqrt(vx*vx+vy*vy)};ga.followEase=function(follower,leader,speed){var vx=leader.centerX-follower.centerX,vy=leader.centerY-follower.centerY,distance=Math.sqrt(vx*vx+vy*vy);if(distance>=1){follower.x+=vx*speed;follower.y+=vy*speed}};ga.followConstant=function(follower,leader,speed){var vx=leader.centerX-follower.centerX,vy=leader.centerY-follower.centerY,distance=Math.sqrt(vx*vx+vy*vy);if(distance>=speed){follower.x+=(vx/distance)*speed;
follower.y+=(vy/distance)*speed}};ga.rotateAroundSprite=function(rotatingSprite,centerSprite,distance,angle){rotatingSprite.x=centerSprite.centerX-rotatingSprite.parent.x+(distance*Math.cos(angle))-rotatingSprite.halfWidth;rotatingSprite.y=centerSprite.centerY-rotatingSprite.parent.y+(distance*Math.sin(angle))-rotatingSprite.halfWidth};ga.rotateAroundPoint=function(pointX,pointY,distanceX,distanceY,angle){var point={};point.x=pointX+Math.cos(angle)*distanceX;point.y=pointY+Math.sin(angle)*distanceY;return point};ga.angle=function(s1,s2){return Math.atan2(s2.centerY-s1.centerY,s2.centerX-s1.centerX)};ga.randomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min};ga.randomFloat=function(min,max){return min+Math.random()*(max-min)};ga.wait=function(duration,callBack){return setTimeout(callBack,duration)};ga.worldCamera=function(world,canvas){var camera={width:canvas.width,height:canvas.height,_x:0,_y:0,get xfunction(){return this._x},set xfunction(value){this._x=value;world.x=-this._x;world._previousX=world.x},get yfunction(){return this._y},set yfunction(value){this._y=value;world.y=-this._y;world._previousY=world.y},get centerXfunction(){return this.x+(this.width/2)},get centerYfunction(){return this.y+(this.height/2)},get rightInnerBoundaryfunction(){return this.x+(this.width/2)+(this.width/4)},get leftInnerBoundaryfunction(){return this.x+(this.width/2)-(this.width/4)},get topInnerBoundaryfunction(){return this.y+(this.height/2)-(this.height/4)},get bottomInnerBoundaryfunction(){return this.y+(this.height/2)+(this.height/4)},follow:function(sprite){if(sprite.x<this.leftInnerBoundary){this.x=sprite.x-(this.width/4)}if(sprite.y<this.topInnerBoundary){this.y=sprite.y-(this.height/4)}if(sprite.x+sprite.width>this.rightInnerBoundary){this.x=sprite.x+sprite.width-(this.width/4*3)}if(sprite.y+sprite.height>this.bottomInnerBoundary){this.y=sprite.y+sprite.height-(this.height/4*3)}if(this.x<0){this.x=0}if(this.y<0){this.y=0}if(this.x+this.width>world.width){this.x=world.width-this.width}if(this.y+this.height>world.height){this.y=world.height-this.height}},centerOver:function(sprite){this.x=(sprite.x+sprite.halfWidth)-(this.width/2);this.y=(sprite.y+sprite.halfHeight)-(this.height/2)}};return camera};ga.scaleToWindow=function(backgroundColor){backgroundColor=backgroundColor||"#2C3539";var scaleX,scaleY,scale,center;scaleX=window.innerWidth/ga.canvas.width;scaleY=window.innerHeight/ga.canvas.height;scale=Math.min(scaleX,scaleY);ga.canvas.style.transformOrigin="0 0";ga.canvas.style.transform="scale("+scale+")";if(ga.canvas.width>ga.canvas.height){if(ga.canvas.width*scale<window.innerWidth){center="horizontally"}else{center="vertically"}}else{if(ga.canvas.height*scale<window.innerHeight){center="vertically"}else{center="horizontally"}}var margin;if(center==="horizontally"){margin=(window.innerWidth-ga.canvas.width*scale)/2;ga.canvas.style.marginLeft=margin+"px";ga.canvas.style.marginRight=margin+"px"}if(center==="vertically"){margin=(window.innerHeight-ga.canvas.height*scale)/2;ga.canvas.style.marginTop=margin+"px";ga.canvas.style.marginBottom=margin+"px"}ga.canvas.style.paddingLeft=0;ga.canvas.style.paddingRight=0;ga.canvas.style.paddingTop=0;ga.canvas.style.paddingBottom=0;ga.canvas.style.display="block";document.body.style.backgroundColor=backgroundColor;ga.pointer.scale=scale;ga.scale=scale;ga.canvas.scaled=true;var ua=navigator.userAgent.toLowerCase();if(ua.indexOf("safari")!=-1){if(ua.indexOf("chrome")>-1){}else{ga.canvas.style.maxHeight="100%";ga.canvas.style.minHeight="100%"}}};ga.scaleToFit=function(dimension,color){var scaleX,scaleY,scale;if(dimension==="width"){scaleX=ga.canvas.width/window.innerWidth;scaleY=ga.canvas.height/window.innerHeight}if(dimension==="height"){scaleX=window.innerWidth/ga.canvas.width;scaleY=window.innerHeight/ga.canvas.height}scale=Math.min(scaleX,scaleY);ga.canvas.style.transformOrigin="0 0";ga.canvas.style.transform="scale("+scale+")";document.body.style.backgroundColor=color;ga.canvas.style.paddingLeft=0;ga.canvas.style.paddingRight=0;ga.canvas.style.marginLeft="auto";ga.canvas.style.marginRight="auto";ga.canvas.style.display="block";ga.canvas.style.minHeight="100%";var ua=navigator.userAgent.toLowerCase();if(ua.indexOf("safari")!=-1){if(ua.indexOf("chrome")>-1){}else{ga.canvas.style.maxHeight="100%";ga.canvas.style.minHeight="100%"}}ga.scale=scale};ga.shakingSprites=[];ga.updateShakingSprites=function(){if(ga.shakingSprites.length>0){for(var i=ga.shakingSprites.length-1;i>=0;i--){var shakingSprite=ga.shakingSprites[i];if(shakingSprite.updateShake){shakingSprite.updateShake()}}}};ga.updateFunctions.push(ga.updateShakingSprites);ga.shake=function(sprite,magnitude,angular){if(magnitude===undefined){magnitude=16}if(angular===undefined){angular=false}var counter=1;var numberOfShakes=10;var startX=sprite.x,startY=sprite.y,startAngle=sprite.rotation;var magnitudeUnit=magnitude/numberOfShakes;var randomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min
};if(ga.shakingSprites.indexOf(sprite)===-1){ga.shakingSprites.push(sprite);sprite.updateShake=function(){if(angular){angularShake()}else{upAndDownShake()}}}function upAndDownShake(){if(counter<numberOfShakes){sprite.x=startX;sprite.y=startY;magnitude-=magnitudeUnit;sprite.x+=randomInt(-magnitude,magnitude);sprite.y+=randomInt(-magnitude,magnitude);counter+=1}if(counter>=numberOfShakes){sprite.x=startX;sprite.y=startY;ga.shakingSprites.splice(ga.shakingSprites.indexOf(sprite),1)}}var tiltAngle=1;function angularShake(){if(counter<numberOfShakes){sprite.rotation=startAngle;magnitude-=magnitudeUnit;sprite.rotation=magnitude*tiltAngle;counter+=1;tiltAngle*=-1}if(counter>=numberOfShakes){sprite.rotation=startAngle;ga.shakingSprites.splice(ga.shakingSprites.indexOf(sprite),1)}}};ga.tweens=[];ga.updateTweens=function(){if(ga.tweens.length>0){for(var i=ga.tweens.length-1;i>=0;i--){var tween=ga.tweens[i];if(tween){tween.update()}}}};ga.updateFunctions.push(ga.updateTweens);ga.cubicBezier=function(t,a,b,c,d){var t2=t*t;var t3=t2*t;return a+(-a*3+t*(3*a-a*t))*t+(3*b+t*(-6*b+b*3*t))*t+(c*3-c*3*t)*t2+d*t3};var ease={linear:function(x){return x},smoothstep:function(x){return x*x*(3-2*x)},smoothstepSquared:function(x){return Math.pow((x*x*(3-2*x)),2)},smoothstepCubed:function(x){return Math.pow((x*x*(3-2*x)),3)},acceleration:function(x){return x*x},accelerationCubed:function(x){return Math.pow(x*x,3)},deceleration:function(x){return 1-Math.pow(1-x,2)},decelerationCubed:function(x){return 1-Math.pow(1-x,3)},sine:function(x){return Math.sin(x*Math.PI/2)},sineSquared:function(x){return Math.pow(Math.sin(x*Math.PI/2),2)},sineCubed:function(x){return Math.pow(Math.sin(x*Math.PI/2),2)},inverseSine:function(x){return 1-Math.sin((1-x)*Math.PI/2)},inverseSineSquared:function(x){return 1-Math.pow(Math.sin((1-x)*Math.PI/2),2)},inverseSineCubed:function(x){return 1-Math.pow(Math.sin((1-x)*Math.PI/2),3)},spline:function(t,p0,p1,p2,p3){return 0.5*((2*p1)+(-p0+p2)*t+(2*p0-5*p1+4*p2-p3)*t*t+(-p0+3*p1-3*p2+p3)*t*t*t)}};ga.tweenProperty=function(sprite,property,startValue,endValue,totalFrames,type,yoyo,delayBeforeRepeat){if(totalFrames===undefined){totalFrames=60}if(type===undefined){type="smoothstep"}if(yoyo===undefined){yoyo=false}if(delayBeforeRepeat===undefined){delayBeforeRepeat=0}var o={};var typeArray=type.split(" ");if(typeArray[0]==="bounce"){o.startMagnitude=parseInt(typeArray[1]);o.endMagnitude=parseInt(typeArray[2])}o.start=function(startValue,endValue){o.startValue=JSON.parse(JSON.stringify(startValue));o.endValue=JSON.parse(JSON.stringify(endValue));o.playing=true;o.totalFrames=totalFrames;o.frameCounter=0;ga.tweens.push(o)};o.start(startValue,endValue);o.update=function(){var time,curvedTime;if(o.playing){if(o.frameCounter<o.totalFrames){var normalizedTime=o.frameCounter/o.totalFrames;if(typeArray[0]!=="bounce"){curvedTime=ease[type](normalizedTime)}else{curvedTime=ease.spline(normalizedTime,o.startMagnitude,0,1,o.endMagnitude)}sprite[property]=(o.endValue*curvedTime)+(o.startValue*(1-curvedTime));o.frameCounter+=1}else{o.end()}}};o.end=function(){o.playing=false;if(o.onComplete){o.onComplete()}ga.tweens.splice(ga.tweens.indexOf(o),1);if(yoyo){ga.wait(delayBeforeRepeat,function(){o.start(o.endValue,o.startValue)})}};o.play=function(){o.playing=true};o.pause=function(){o.playing=false};return o};ga.fadeOut=function(sprite,frames){if(frames===undefined){frames=60}return ga.tweenProperty(sprite,"alpha",sprite.alpha,0,frames,"sine")};ga.fadeIn=function(sprite,frames){if(frames===undefined){frames=60}return ga.tweenProperty(sprite,"alpha",sprite.alpha,1,frames,"sine")};ga.pulse=function(sprite,frames,minAlpha){if(frames===undefined){frames=60}if(minAlpha===undefined){minAlpha=0}return ga.tweenProperty(sprite,"alpha",sprite.alpha,minAlpha,frames,"smoothstep",true)};ga.makeTween=function(tweensToAdd){var o={};o.tweens=[];tweensToAdd.forEach(function(tweenPropertyArguments){var newTween=ga.tweenProperty(tweenPropertyArguments[0],tweenPropertyArguments[1],tweenPropertyArguments[2],tweenPropertyArguments[3],tweenPropertyArguments[4],tweenPropertyArguments[5],tweenPropertyArguments[6],tweenPropertyArguments[7]);o.tweens.push(newTween)});var completionCounter=0;o.completed=function(){completionCounter+=1;if(completionCounter===o.tweens.length){if(o.onComplete){o.onComplete()}completionCounter=0}};o.tweens.forEach(function(tween){tween.onComplete=function(){o.completed()}});o.pause=function(){o.tweens.forEach(function(tween){tween.playing=false})};o.play=function(){o.tweens.forEach(function(tween){tween.playing=true})};return o};ga.slide=function(sprite,endX,endY,frames,type,yoyo,delayBeforeRepeat){if(frames===undefined){frames=60}if(type===undefined){type="smoothstep"}if(yoyo===undefined){yoyo=false}if(delayBeforeRepeat===undefined){delayBeforeRepeat=0}return ga.makeTween([[sprite,"x",sprite.x,endX,frames,type,yoyo,delayBeforeRepeat],[sprite,"y",sprite.y,endY,frames,type,yoyo,delayBeforeRepeat]])};ga.breathe=function(sprite,endScaleX,endScaleY,frames,yoyo,delayBeforeRepeat){if(frames===undefined){frames=60
}if(yoyo===undefined){yoyo=true}if(delayBeforeRepeat===undefined){delayBeforeRepeat=0}return ga.makeTween([[sprite,"scaleX",sprite.scaleX,endScaleX,frames,"smoothstepSquared",yoyo,delayBeforeRepeat],[sprite,"scaleY",sprite.scaleY,endScaleY,frames,"smoothstepSquared",yoyo,delayBeforeRepeat]])};ga.scale=function(sprite,endScaleX,endScaleY,frames){if(frames===undefined){frames=60}return ga.makeTween([[sprite,"scaleX",sprite.scaleX,endScaleX,frames,"smoothstep",false],[sprite,"scaleY",sprite.scaleY,endScaleY,frames,"smoothstep",false]])};ga.strobe=function(sprite,scaleFactor,startMagnitude,endMagnitude,frames,yoyo,delayBeforeRepeat){if(scaleFactor===undefined){scaleFactor=1.3}if(startMagnitude===undefined){startMagnitude=10}if(endMagnitude===undefined){endMagnitude=20}if(frames===undefined){frames=10}if(yoyo===undefined){yoyo=true}if(delayBeforeRepeat===undefined){delayBeforeRepeat=0}var bounce="bounce "+startMagnitude+" "+endMagnitude;return ga.makeTween([[sprite,"scaleX",sprite.scaleX,scaleFactor,frames,bounce,yoyo,delayBeforeRepeat],[sprite,"scaleY",sprite.scaleY,scaleFactor,frames,bounce,yoyo,delayBeforeRepeat]])};ga.wobble=function(sprite,scaleFactorX,scaleFactorY,frames,xStartMagnitude,xEndMagnitude,yStartMagnitude,yEndMagnitude,friction,yoyo,delayBeforeRepeat){if(scaleFactorX===undefined){scaleFactorX=1.2}if(scaleFactorY===undefined){scaleFactorY=1.2}if(frames===undefined){frames=10}if(xStartMagnitude===undefined){xStartMagnitude=10}if(xEndMagnitude===undefined){xEndMagnitude=10}if(yStartMagnitude===undefined){yStartMagnitude=-10}if(yEndMagnitude===undefined){yEndMagnitude=-10}if(friction===undefined){friction=0.98}if(yoyo===undefined){yoyo=true}if(delayBeforeRepeat===undefined){delayBeforeRepeat=0}var bounceX="bounce "+xStartMagnitude+" "+xEndMagnitude,bounceY="bounce "+yStartMagnitude+" "+yEndMagnitude;var o=ga.makeTween([[sprite,"scaleX",sprite.scaleX,scaleFactorX,frames,bounceX,yoyo,delayBeforeRepeat],[sprite,"scaleY",sprite.scaleY,scaleFactorY,frames,bounceY,yoyo,delayBeforeRepeat]]);o.tweens.forEach(function(tween){tween.onComplete=function(){if(tween.endValue>1){tween.endValue*=friction;if(tween.endValue<=1){tween.endValue=1;ga.removeTween(tween)}}}});return o};ga.removeTween=function(tweenObject){if(!tweenObject.tweens){tweenObject.pause();ga.tweens.splice(ga.tweens.indexOf(tweenObject),1)}else{tweenObject.pause();tweenObject.tweens.forEach(function(element){ga.tweens.splice(ga.tweens.indexOf(element),1)})}};ga.followCurve=function(sprite,pointsArray,totalFrames,type,yoyo,delayBeforeRepeat){if(type===undefined){type="smoothstep"}if(yoyo===undefined){yoyo=false}if(delayBeforeRepeat===undefined){delayBeforeRepeat=0}var o={};var typeArray=type.split(" ");if(typeArray[0]==="bounce"){o.startMagnitude=parseInt(typeArray[1]);o.endMagnitude=parseInt(typeArray[2])}o.start=function(pointsArray){o.playing=true;o.totalFrames=totalFrames;o.frameCounter=0;o.pointsArray=JSON.parse(JSON.stringify(pointsArray));ga.tweens.push(o)};o.start(pointsArray);o.update=function(){var normalizedTime,curvedTime,p=o.pointsArray;if(o.playing){if(o.frameCounter<o.totalFrames){normalizedTime=o.frameCounter/o.totalFrames;if(typeArray[0]!=="bounce"){curvedTime=ease[type](normalizedTime)}else{curvedTime=ease.spline(normalizedTime,o.startMagnitude,0,1,o.endMagnitude)}sprite.x=ga.cubicBezier(curvedTime,p[0][0],p[1][0],p[2][0],p[3][0]);sprite.y=ga.cubicBezier(curvedTime,p[0][1],p[1][1],p[2][1],p[3][1]);o.frameCounter+=1}else{o.end()}}};o.end=function(){o.playing=false;if(o.onComplete){o.onComplete()}ga.tweens.splice(ga.tweens.indexOf(o),1);if(yoyo){ga.wait(delayBeforeRepeat,function(){o.pointsArray=o.pointsArray.reverse();o.start(o.pointsArray)})}};o.pause=function(){o.playing=false};o.play=function(){o.playing=true};return o};ga.walkPath=function(sprite,originalPathArray,totalFrames,type,loop,yoyo,delayBetweenSections){if(totalFrames===undefined){totalFrames=300}if(type===undefined){type="smoothstep"}if(loop===undefined){loop=false}if(yoyo===undefined){yoyo=false}if(delayBetweenSections===undefined){delayBetweenSections=0}var pathArray=JSON.parse(JSON.stringify(originalPathArray));var frames=totalFrames/pathArray.length;var currentPoint=0;var tween=makePath(currentPoint);function makePath(currentPoint){var tween=ga.makeTween([[sprite,"x",pathArray[currentPoint][0],pathArray[currentPoint+1][0],frames,type],[sprite,"y",pathArray[currentPoint][1],pathArray[currentPoint+1][1],frames,type]]);tween.onComplete=function(){currentPoint+=1;if(currentPoint<pathArray.length-1){ga.wait(delayBetweenSections,function(){tween=makePath(currentPoint)})}else{if(loop){if(yoyo){pathArray.reverse()}ga.wait(delayBetweenSections,function(){currentPoint=0;sprite.x=pathArray[0][0];sprite.y=pathArray[0][1];tween=makePath(currentPoint)})}}};return tween}return tween};ga.walkCurve=function(sprite,pathArray,totalFrames,type,loop,yoyo,delayBeforeContinue){if(totalFrames===undefined){totalFrames=300}if(type===undefined){type="smoothstep"}if(loop===undefined){loop=false
}if(yoyo===undefined){yoyo=false}if(delayBeforeContinue===undefined){delayBeforeContinue=0}var frames=totalFrames/pathArray.length;var currentCurve=0;var tween=makePath(currentCurve);function makePath(currentCurve){var tween=ga.followCurve(sprite,pathArray[currentCurve],frames,type);tween.onComplete=function(){currentCurve+=1;if(currentCurve<pathArray.length){ga.wait(delayBeforeContinue,function(){tween=makePath(currentCurve)})}else{if(loop){if(yoyo){pathArray.reverse();pathArray.forEach(function(curveArray){curveArray.reverse()})}ga.wait(delayBeforeContinue,function(){currentCurve=0;sprite.x=pathArray[0][0];sprite.y=pathArray[0][1];tween=makePath(currentCurve)})}}};return tween}return tween};ga.shoot=function(shooter,angle,offsetFromCenter,bulletSpeed,bulletArray,bulletSprite){var bullet=bulletSprite();bullet.x=shooter.centerX-bullet.halfWidth+(offsetFromCenter*Math.cos(angle));bullet.y=shooter.centerY-bullet.halfHeight+(offsetFromCenter*Math.sin(angle));bullet.vx=Math.cos(angle)*bulletSpeed;bullet.vy=Math.sin(angle)*bulletSpeed;bulletArray.push(bullet);return bullet};ga.grid=function(columns,rows,cellWidth,cellHeight,centerCell,xOffset,yOffset,makeSprite,extra){if(columns===undefined){columns=0}if(rows===undefined){rows=0}if(cellWidth===undefined){cellWidth=32}if(cellHeight===undefined){cellHeight=32}if(xOffset===undefined){xOffset=0}if(yOffset===undefined){yOffset=0}if(centerCell===undefined){centerCell=false}var container=ga.group();container.createGrid=function(){var length=columns*rows;for(var i=0;i<length;i++){var x=((i%columns)*cellWidth),y=(Math.floor(i/columns)*cellHeight);var sprite=makeSprite();container.addChild(sprite);if(!centerCell){sprite.x=x+xOffset;sprite.y=y+yOffset}else{sprite.x=x+(cellWidth/2)-sprite.halfWidth+xOffset;sprite.y=y+(cellHeight/2)-sprite.halfHeight+yOffset}if(extra){extra(sprite)}}};container.createGrid();ga.stage.addChild(container);return container};ga.progressBar={maxWidth:0,height:0,backgroundColor:"gray",foregroundColor:"cyan",backBar:null,frontBar:null,percentage:null,assets:null,initialized:false,create:function(canvas,assets){if(!this.initialized){this.assets=assets;this.maxWidth=ga.canvas.width/2;this.backBar=ga.rectangle(this.maxWidth,32,this.backgroundColor);this.backBar.x=(ga.canvas.width/2)-(this.maxWidth/2);this.backBar.y=(ga.canvas.height/2)-16;this.frontBar=ga.rectangle(this.maxWidth,32,this.foregroundColor);this.frontBar.x=(ga.canvas.width/2)-(this.maxWidth/2);this.frontBar.y=(ga.canvas.height/2)-16;this.percentage=ga.text("0%","28px sans-serif","black");this.percentage.x=(ga.canvas.width/2)-(this.maxWidth/2)+12;this.percentage.y=(ga.canvas.height/2)-12;this.initialized=true}},update:function(){var ratio=(ga.assets.loaded+1)/ga.assets.toLoad;this.frontBar.width=this.maxWidth*ratio;this.percentage.content=Math.floor((ratio)*100)+"%"},remove:function(){ga.remove(this.frontBar);ga.remove(this.backBar);ga.remove(this.percentage)}};ga.particles=[];ga.particleEffect=function(x,y,spriteFunction,numberOfParticles,gravity,randomSpacing,minAngle,maxAngle,minSize,maxSize,minSpeed,maxSpeed,minScaleSpeed,maxScaleSpeed,minAlphaSpeed,maxAlphaSpeed,minRotationSpeed,maxRotationSpeed){if(x===undefined){x=0}if(y===undefined){y=0}if(spriteFunction===undefined){spriteFunction=function(){return ga.circle(10,"red")}}if(numberOfParticles===undefined){numberOfParticles=10}if(gravity===undefined){gravity=0}if(randomSpacing===undefined){randomSpacing=true}if(minAngle===undefined){minAngle=0}if(maxAngle===undefined){maxAngle=6.28}if(minSize===undefined){minSize=4}if(maxSize===undefined){maxSize=16}if(minSpeed===undefined){minSpeed=0.1}if(maxSpeed===undefined){maxSpeed=1}if(minScaleSpeed===undefined){minScaleSpeed=0.01}if(maxScaleSpeed===undefined){maxScaleSpeed=0.05}if(minAlphaSpeed===undefined){minAlphaSpeed=0.02}if(maxAlphaSpeed===undefined){maxAlphaSpeed=0.02}if(minRotationSpeed===undefined){minRotationSpeed=0.01}if(maxRotationSpeed===undefined){maxRotationSpeed=0.03}var randomFloat=function(min,max){return min+Math.random()*(max-min)},randomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min};var angles=[];var angle;var spacing=(maxAngle-minAngle)/(numberOfParticles-1);for(var i=0;i<numberOfParticles;i++){if(randomSpacing){angle=randomFloat(minAngle,maxAngle);angles.push(angle)}else{if(angle===undefined){angle=minAngle}angles.push(angle);angle+=spacing}}angles.forEach(function(angle){makeParticle(angle)});function makeParticle(angle){var particle=spriteFunction();if(particle.frames.length>0){particle.gotoAndStop(randomInt(0,particle.frames.length-1))}particle.x=x-particle.halfWidth;particle.y=y-particle.halfHeight;var size=randomInt(minSize,maxSize);particle.width=size;particle.height=size;particle.scaleSpeed=randomFloat(minScaleSpeed,maxScaleSpeed);particle.alphaSpeed=randomFloat(minAlphaSpeed,maxAlphaSpeed);particle.rotationSpeed=randomFloat(minRotationSpeed,maxRotationSpeed);var speed=randomFloat(minSpeed,maxSpeed);particle.vx=speed*Math.cos(angle);particle.vy=speed*Math.sin(angle);
particle.updateParticle=function(){particle.vy+=gravity;particle.x+=particle.vx;particle.y+=particle.vy;if(particle.scaleX-particle.scaleSpeed>0){particle.scaleX-=particle.scaleSpeed}if(particle.scaleY-particle.scaleSpeed>0){particle.scaleY-=particle.scaleSpeed}particle.rotation+=particle.rotationSpeed;particle.alpha-=particle.alphaSpeed;if(particle.alpha<=0){ga.remove(particle);ga.particles.splice(ga.particles.indexOf(particle),1)}};ga.particles.push(particle)}};ga.updateParticles=function(){if(ga.particles.length>0){for(var i=ga.particles.length-1;i>=0;i--){var particle=ga.particles[i];particle.updateParticle()}}};ga.updateFunctions.push(ga.updateParticles);ga.emitter=function(interval,particleFunction){var emitter={},timerInterval=undefined;emitter.playing=false;function play(){if(!emitter.playing){particleFunction();timerInterval=setInterval(emitParticle.bind(this),interval);emitter.playing=true}}function stop(){if(emitter.playing){clearInterval(timerInterval);emitter.playing=false}}function emitParticle(){particleFunction()}emitter.play=play;emitter.stop=stop;return emitter};ga.tilingSprite=function(width,height,source,x,y){if(x===undefined){x=0}if(y===undefined){y=0}var tileWidth,tileHeight;if(ga.assets[source].frame){tileWidth=ga.assets[source].frame.w;tileHeight=ga.assets[source].frame.h}else{tileWidth=ga.assets[source].width;tileHeight=ga.assets[source].height}var columns,rows;if(width>=tileWidth){columns=Math.round(width/tileWidth)+1}else{columns=2}if(height>=tileHeight){rows=Math.round(height/tileHeight)+1}else{rows=2}var tileGrid=ga.grid(columns,rows,tileWidth,tileHeight,false,0,0,function(){var tile=ga.sprite(source);return tile});tileGrid._tileX=0;tileGrid._tileY=0;var container=ga.rectangle(width,height,"none","none");container.x=x;container.y=y;container.mask=true;container.addChild(tileGrid);Object.defineProperties(container,{tileX:{get:function(){return tileGrid._tileX},set:function(value){tileGrid.children.forEach(function(child){var difference=value-tileGrid._tileX;child.x+=difference;if(child.x>(columns-1)*tileWidth){child.x=0-tileWidth+difference}if(child.x<0-tileWidth-difference){child.x=(columns-1)*tileWidth}});tileGrid._tileX=value},enumerable:true,configurable:true},tileY:{get:function(){return tileGrid._tileY},set:function(value){tileGrid.children.forEach(function(child){var difference=value-tileGrid._tileY;child.y+=difference;if(child.y>(rows-1)*tileHeight){child.y=0-tileHeight+difference}if(child.y<0-tileHeight-difference){child.y=(rows-1)*tileHeight}});tileGrid._tileY=value},enumerable:true,configurable:true}});return container};ga.burst=function(x,y,spriteFunction,numberOfParticles,minSize,maxSize,minSpeed,maxSpeed,minScaleSpeed,maxScaleSpeed,minAlphaSpeed,maxAlphaSpeed,minRotationSpeed,maxRotationSpeed){x=x||0;y=y||0;spriteFunction=spriteFunction||function(){return ga.circle(10,"red")};minSize=minSize||4;maxSize=maxSize||16;numberOfParticles=numberOfParticles||10;minSpeed=minSpeed||0.1;maxSpeed=maxSpeed||1;minScaleSpeed=minScaleSpeed||0.01;maxScaleSpeed=maxScaleSpeed||0.05;minAlphaSpeed=minAlphaSpeed||0.02;maxAlphaSpeed=maxAlphaSpeed||0.02;minRotationSpeed=minRotationSpeed||0.01;maxRotationSpeed=maxRotationSpeed||0.03;var angle;for(angle=0;angle<360;angle+=Math.round(360/numberOfParticles)){makeParticle()}function makeParticle(){var particle=spriteFunction();particle.x=x-particle.halfWidth;particle.y=y-particle.halfHeight;var size=ga.randomFloat(minSize,maxSize);particle.width=size;particle.height=size;particle.scaleSpeed=ga.randomFloat(minScaleSpeed,maxScaleSpeed);particle.alphaSpeed=ga.randomFloat(minAlphaSpeed,maxAlphaSpeed);particle.rotationSpeed=ga.randomFloat(minRotationSpeed,maxRotationSpeed);var speed=ga.randomFloat(minSpeed,maxSpeed);particle.vx=speed*Math.cos(angle*Math.PI/180);particle.vy=speed*Math.sin(angle*Math.PI/180);particle.update=function(){particle.x+=particle.vx;particle.y+=particle.vy;if(particle.scaleX-particle.scaleSpeed>0){particle.scaleX-=particle.scaleSpeed}if(particle.scaleY-particle.scaleSpeed>0){particle.scaleY-=particle.scaleSpeed}particle.rotation+=particle.rotationSpeed;particle.alpha-=particle.alphaSpeed;if(particle.alpha<=0){ga.remove(particle);ga.particles.splice(ga.particles.indexOf(particle),1)}};ga.particles.push(particle)}};ga.outsideBounds=function(s,bounds,extra){var x=bounds.x,y=bounds.y,width=bounds.width,height=bounds.height;var collision;if(s.x<x-s.width){collision="left"}if(s.y<y-s.height){collision="top"}if(s.x>width){collision="right"}if(s.y>height){collision="bottom"}if(collision&&extra){extra(collision)}return collision};ga.contain=function(s,bounds,bounce,extra){var x=bounds.x,y=bounds.y,width=bounds.width,height=bounds.height;bounce=bounce||false;var collision;if(s.x<x){if(bounce){s.vx*=-1}if(s.mass){s.vx/=s.mass}s.x=x;collision="left"}if(s.y<y){if(bounce){s.vy*=-1}if(s.mass){s.vy/=s.mass}s.y=y;collision="top"}if(s.x+s.width>width){if(bounce){s.vx*=-1}if(s.mass){s.vx/=s.mass}s.x=width-s.width;collision="right"}if(s.y+s.height>height){if(bounce){s.vy*=-1
}if(s.mass){s.vy/=s.mass}s.y=height-s.height;collision="bottom"}if(collision&&extra){extra(collision)}return collision};ga.hitTestPoint=function(point,sprite){var shape,left,right,top,bottom,vx,vy,magnitude,hit;if(sprite.radius){shape="circle"}else{shape="rectangle"}if(shape==="rectangle"){left=sprite.x;right=sprite.x+sprite.width;top=sprite.y;bottom=sprite.y+sprite.height;hit=point.x>left&&point.x<right&&point.y>top&&point.y<bottom}if(shape==="circle"){vx=point.x-sprite.centerX,vy=point.y-sprite.centerY,magnitude=Math.sqrt(vx*vx+vy*vy);hit=magnitude<sprite.radius}return hit};ga.hitTestCircle=function(c1,c2,global){var vx,vy,magnitude,totalRadii,hit;if(global===undefined){global=false}if(global){vx=(c2.gx+c2.radius)-(c1.gx+c1.radius);vy=(c2.gy+c2.radius)-(c1.gy+c1.radius)}else{vx=c2.centerX-c1.centerX;vy=c2.centerY-c1.centerY}magnitude=Math.sqrt(vx*vx+vy*vy);totalRadii=c1.radius+c2.radius;hit=magnitude<totalRadii;return hit};ga.hitTestRectangle=function(r1,r2,global){var hit,combinedHalfWidths,combinedHalfHeights,vx,vy;if(global===undefined){global=false}hit=false;if(global){vx=(r1.gx+r1.halfWidth)-(r2.gx+r2.halfWidth);vy=(r1.gy+r1.halfHeight)-(r2.gy+r2.halfHeight)}else{vx=r1.centerX-r2.centerX;vy=r1.centerY-r2.centerY}combinedHalfWidths=r1.halfWidth+r2.halfWidth;combinedHalfHeights=r1.halfHeight+r2.halfHeight;if(Math.abs(vx)<combinedHalfWidths){if(Math.abs(vy)<combinedHalfHeights){hit=true}else{hit=false}}else{hit=false}return hit};ga.hitTestCircleRectangle=function(c1,r1,global){var region,collision,c1x,c1y,r1x,r1y;if(global===undefined){global=false}if(global){c1x=c1.gx;c1y=c1.gy;r1x=r1.gx;r1y=r1.gy}else{c1x=c1.x;c1y=c1.y;r1x=r1.x;r1y=r1.y}if(c1y<r1y-r1.halfHeight){if(c1x<r1x-1-r1.halfWidth){region="topLeft"}else{if(c1x>r1x+1+r1.halfWidth){region="topRight"}else{region="topMiddle"}}}else{if(c1y>r1y+r1.halfHeight){if(c1x<r1x-1-r1.halfWidth){region="bottomLeft"}else{if(c1x>r1x+1+r1.halfWidth){region="bottomRight"}else{region="bottomMiddle"}}}else{if(c1x<r1x-r1.halfWidth){region="leftMiddle"}else{region="rightMiddle"}}}if(region==="topMiddle"||region==="bottomMiddle"||region==="leftMiddle"||region==="rightMiddle"){collision=ga.hitTestRectangle(c1,r1,global)}else{var point={};switch(region){case"topLeft":point.x=r1x;point.y=r1y;break;case"topRight":point.x=r1x+r1.width;point.y=r1y;break;case"bottomLeft":point.x=r1x;point.y=r1y+r1.height;break;case"bottomRight":point.x=r1x+r1.width;point.y=r1y+r1.height}collision=ga.hitTestCirclePoint(c1,point,global)}if(collision){return region}else{return collision}};ga.hitTestCirclePoint=function(c1,point,global){if(global===undefined){global=false}point.diameter=1;point.radius=0.5;point.centerX=point.x;point.centerY=point.y;point.gx=point.x;point.gy=point.y;return ga.hitTestCircle(c1,point,global)};ga.rectangleCollision=function(r1,r2,bounce,global){var collision,combinedHalfWidths,combinedHalfHeights,overlapX,overlapY,vx,vy;if(bounce===undefined){bounce=false}if(global===undefined){global=false}if(global){vx=(r1.gx+r1.halfWidth)-(r2.gx+r2.halfWidth);vy=(r1.gy+r1.halfHeight)-(r2.gy+r2.halfHeight)}else{vx=r1.centerX-r2.centerX;vy=r1.centerY-r2.centerY}combinedHalfWidths=r1.halfWidth+r2.halfWidth;combinedHalfHeights=r1.halfHeight+r2.halfHeight;if(Math.abs(vx)<combinedHalfWidths){if(Math.abs(vy)<combinedHalfHeights){overlapX=combinedHalfWidths-Math.abs(vx);overlapY=combinedHalfHeights-Math.abs(vy);if(overlapX>=overlapY){if(vy>0){collision="top";r1.y=r1.y+overlapY}else{collision="bottom";r1.y=r1.y-overlapY}if(bounce){r1.vy*=-1}}else{if(vx>0){collision="left";r1.x=r1.x+overlapX}else{collision="right";r1.x=r1.x-overlapX}if(bounce){r1.vx*=-1}}}else{}}else{}return collision};ga.circleCollision=function(c1,c2,bounce,global){var magnitude,combinedRadii,overlap,vx,vy,dx,dy,s={},hit=false;if(bounce===undefined){bounce=true}if(global===undefined){global=false}if(global){vx=(c2.gx+c2.radius)-(c1.gx+c1.radius);vy=(c2.gy+c2.radius)-(c1.gy+c1.radius)}else{vx=c2.centerX-c1.centerX;vy=c2.centerY-c1.centerY}magnitude=Math.sqrt(vx*vx+vy*vy);combinedRadii=c1.radius+c2.radius;if(magnitude<combinedRadii){hit=true;overlap=combinedRadii-magnitude;var quantumPadding=0.3;overlap+=quantumPadding;dx=vx/magnitude;dy=vy/magnitude;c1.x-=overlap*dx;c1.y-=overlap*dy;if(bounce){s.x=vy;s.y=-vx;bounceOffSurface(c1,s)}else{}}return hit};ga.movingCircleCollision=function(c1,c2,global){var combinedRadii,overlap,xSide,ySide,s={},p1A={},p1B={},p2A={},p2B={},hit=false;c1.mass=c1.mass||1;c2.mass=c2.mass||1;if(global===undefined){global=false}if(global){s.vx=(c2.gx+c2.radius)-(c1.gx+c1.radius);s.vy=(c2.gy+c2.radius)-(c1.gy+c1.radius)}else{s.vx=c2.centerX-c1.centerX;s.vy=c2.centerY-c1.centerY}s.magnitude=Math.sqrt(s.vx*s.vx+s.vy*s.vy);combinedRadii=c1.radius+c2.radius;if(s.magnitude<combinedRadii){hit=true;overlap=combinedRadii-s.magnitude;overlap+=0.3;s.dx=s.vx/s.magnitude;s.dy=s.vy/s.magnitude;s.vxHalf=Math.abs(s.dx*overlap/2);s.vyHalf=Math.abs(s.dy*overlap/2);(c1.x>c2.x)?xSide=1:xSide=-1;(c1.y>c2.y)?ySide=1:ySide=-1;
c1.x=c1.x+(s.vxHalf*xSide);c1.y=c1.y+(s.vyHalf*ySide);c2.x=c2.x+(s.vxHalf*-xSide);c2.y=c2.y+(s.vyHalf*-ySide);s.lx=s.vy;s.ly=-s.vx;var dp1=c1.vx*s.dx+c1.vy*s.dy;p1A.x=dp1*s.dx;p1A.y=dp1*s.dy;var dp2=c1.vx*(s.lx/s.magnitude)+c1.vy*(s.ly/s.magnitude);p1B.x=dp2*(s.lx/s.magnitude);p1B.y=dp2*(s.ly/s.magnitude);var dp3=c2.vx*s.dx+c2.vy*s.dy;p2A.x=dp3*s.dx;p2A.y=dp3*s.dy;var dp4=c2.vx*(s.lx/s.magnitude)+c2.vy*(s.ly/s.magnitude);p2B.x=dp4*(s.lx/s.magnitude);p2B.y=dp4*(s.ly/s.magnitude);c1.bounce={};c1.bounce.x=p1B.x+p2A.x;c1.bounce.y=p1B.y+p2A.y;c2.bounce={};c2.bounce.x=p1A.x+p2B.x;c2.bounce.y=p1A.y+p2B.y;c1.vx=c1.bounce.x/c1.mass;c1.vy=c1.bounce.y/c1.mass;c2.vx=c2.bounce.x/c2.mass;c2.vy=c2.bounce.y/c2.mass}return hit};ga.multipleCircleCollision=function(arrayOfCircles,global){if(global===undefined){global=false}for(var i=0;i<arrayOfCircles.length;i++){var c1=arrayOfCircles[i];for(var j=i+1;j<arrayOfCircles.length;j++){var c2=arrayOfCircles[j];ga.movingCircleCollision(c1,c2,global)}}};ga.circlePointCollision=function(c1,point,bounce,global){if(global===undefined){global=false}if(bounce===undefined){bounce=false}point.diameter=1;point.radius=0.5;point.centerX=point.x;point.centerY=point.y;point.gx=point.x;point.gy=point.y;return ga.circleCollision(c1,point,bounce,global)};ga.circleRectangleCollision=function(c1,r1,bounce,global){var region,collision,c1x,c1y,r1x,r1y;if(global===undefined){global=false}if(bounce===undefined){bounce=false}if(global){c1x=c1.gx;c1y=c1.gy;r1x=r1.gx;r1y=r1.gy}else{c1x=c1.x;c1y=c1.y;r1x=r1.x;r1y=r1.y}if(c1y<r1y-r1.halfHeight){if(c1x<r1x-1-r1.halfWidth){region="topLeft"}else{if(c1x>r1x+1+r1.halfWidth){region="topRight"}else{region="topMiddle"}}}else{if(c1y>r1y+r1.halfHeight){if(c1x<r1x-1-r1.halfWidth){region="bottomLeft"}else{if(c1x>r1x+1+r1.halfWidth){region="bottomRight"}else{region="bottomMiddle"}}}else{if(c1x<r1x-r1.halfWidth){region="leftMiddle"}else{region="rightMiddle"}}}if(region==="topMiddle"||region==="bottomMiddle"||region==="leftMiddle"||region==="rightMiddle"){collision=ga.rectangleCollision(c1,r1,bounce,global)}else{var point={};switch(region){case"topLeft":point.x=r1x;point.y=r1y;break;case"topRight":point.x=r1x+r1.width;point.y=r1y;break;case"bottomLeft":point.x=r1x;point.y=r1y+r1.height;break;case"bottomRight":point.x=r1x+r1.width;point.y=r1y+r1.height}collision=ga.circlePointCollision(c1,point,bounce,global)}if(collision){return region}else{return collision}};function bounceOffSurface(o,s){var dp1,dp2,p1={},p2={},bounce={},mass=o.mass||1;s.lx=s.y;s.ly=-s.x;s.magnitude=Math.sqrt(s.x*s.x+s.y*s.y);s.dx=s.x/s.magnitude;s.dy=s.y/s.magnitude;dp1=o.vx*s.dx+o.vy*s.dy;p1.vx=dp1*s.dx;p1.vy=dp1*s.dy;dp2=o.vx*(s.lx/s.magnitude)+o.vy*(s.ly/s.magnitude);p2.vx=dp2*(s.lx/s.magnitude);p2.vy=dp2*(s.ly/s.magnitude);p2.vx*=-1;p2.vy*=-1;bounce.x=p1.vx+p2.vx;bounce.y=p1.vy+p2.vy;o.vx=bounce.x/mass;o.vy=bounce.y/mass}ga.hit=function(a,b,react,bounce,global,extra){var collision;react=react||false;bounce=bounce||false;global=global||false;if(b instanceof Array||a instanceof Array){spriteVsArray()}else{collision=findCollisionType(a,b);if(collision&&extra){extra(collision)}}return collision;function findCollisionType(a,b){var aIsASprite=a.parent!==undefined,bIsASprite=b.parent!==undefined;if(aIsASprite&&bIsASprite){if(a.diameter&&b.diameter){return circleVsCircle(a,b)}else{if(a.diameter&&!b.diameter){return circleVsRectangle(a,b)}else{return rectangleVsRectangle(a,b)}}}else{if(bIsASprite&&!(a.x===undefined)&&!(a.y===undefined)){return ga.hitTestPoint(a,b)}else{throw new Error("I'm sorry, "+a+" and "+b+" cannot be use together in a collision test.")}}}function spriteVsArray(){if(a instanceof Array){var temp=a;b=a;a=temp}for(var i=b.length-1;i>=0;i--){var sprite=b[i];collision=findCollisionType(a,sprite);if(collision&&extra){extra(collision,sprite)}}}function circleVsCircle(a,b){if(!react){return ga.hitTestCircle(a,b,global)}else{if(a.vx+a.vy!==0&&b.vx+b.vy!==0){return ga.movingCircleCollision(a,b,global)}else{return ga.circleCollision(a,b,bounce,global)}}}function rectangleVsRectangle(a,b){if(!react){return ga.hitTestRectangle(a,b,global)}else{if(bounce){return ga.rectangleCollision(a,b,true,global)}else{return ga.rectangleCollision(a,b,false,global)}}}function circleVsRectangle(a,b){if(!react){return ga.hitTestCircleRectangle(a,b,global)}else{return ga.circleRectangleCollision(a,b,bounce,global)}}};ga.getIndex=function(x,y,tilewidth,tileheight,mapWidthInTiles){var index={};index.x=Math.floor(x/tilewidth);index.y=Math.floor(y/tileheight);return index.x+(index.y*mapWidthInTiles)};ga.getTile=function(index,mapArray,world){var tile={};tile.gid=mapArray[index];tile.width=world.tilewidth;tile.height=world.tileheight;tile.halfWidth=world.tilewidth/2;tile.halfHeight=world.tileheight/2;tile.x=((index%world.widthInTiles)*world.tilewidth)+world.x;tile.y=((Math.floor(index/world.widthInTiles))*world.tileheight)+world.y;tile.gx=tile.x;tile.gy=tile.y;tile.centerX=tile.x+world.tilewidth/2;tile.centery=tile.y+world.tileheight/2;
return tile};ga.surroundingCells=function(index,widthInTiles){return[index-widthInTiles-1,index-widthInTiles,index-widthInTiles+1,index-1,index,index+1,index+widthInTiles-1,index+widthInTiles,index+widthInTiles+1,]};ga.getPoints=function(s){var ca=s.collisionArea;if(ca!==undefined){return{topLeft:{x:s.x+ca.x,y:s.y+ca.y},topRight:{x:s.x+ca.x+ca.width,y:s.y+ca.y},bottomLeft:{x:s.x+ca.x,y:s.y+ca.y+ca.height},bottomRight:{x:s.x+ca.x+ca.width,y:s.y+ca.y+ca.height}}}else{return{topLeft:{x:s.x,y:s.y},topRight:{x:s.x+s.width-1,y:s.y},bottomLeft:{x:s.x,y:s.y+s.height-1},bottomRight:{x:s.x+s.width-1,y:s.y+s.height-1}}}};ga.hitTestTile=function(sprite,mapArray,gidToCheck,world,pointsToCheck){pointsToCheck=pointsToCheck||"some";var collision={};switch(pointsToCheck){case"center":var point={center:{x:sprite.centerX,y:sprite.centerY}};sprite.collisionPoints=point;collision.hit=Object.keys(sprite.collisionPoints).some(checkPoints);break;case"every":sprite.collisionPoints=ga.getPoints(sprite);collision.hit=Object.keys(sprite.collisionPoints).every(checkPoints);break;case"some":sprite.collisionPoints=ga.getPoints(sprite);collision.hit=Object.keys(sprite.collisionPoints).some(checkPoints);break}function checkPoints(key){var point=sprite.collisionPoints[key];collision.index=ga.getIndex(point.x,point.y,world.tilewidth,world.tileheight,world.widthInTiles);collision.gid=mapArray[collision.index];if(collision.gid===gidToCheck){return true}else{return false}}return collision};ga.updateMap=function(mapArray,spritesToUpdate,world){var newMapArray=mapArray.map(function(gid){gid=0;return gid});if(spritesToUpdate instanceof Array){spritesToUpdate.forEach(function(sprite){sprite.index=ga.getIndex(sprite.centerX,sprite.centerY,world.tilewidth,world.tileheight,world.widthInTiles);newMapArray[sprite.index]=sprite.gid})}else{var sprite=spritesToUpdate;sprite.index=ga.getIndex(sprite.centerX,sprite.centerY,world.tilewidth,world.tileheight,world.widthInTiles);newMapArray[sprite.index]=sprite.gid}return newMapArray};ga.fourKeyController=function(s,speed,up,right,down,left){s.direction="";leftArrow=ga.keyboard(left);upArrow=ga.keyboard(up);rightArrow=ga.keyboard(right);downArrow=ga.keyboard(down);leftArrow.press=function(){s.vx=-speed;s.vy=0;s.direction="left"};leftArrow.release=function(){if(!rightArrow.isDown&&s.vy===0){s.vx=0}};upArrow.press=function(){s.vy=-speed;s.vx=0;s.direction="up"};upArrow.release=function(){if(!downArrow.isDown&&s.vx===0){s.vy=0}};rightArrow.press=function(){s.vx=speed;s.vy=0;s.direction="right"};rightArrow.release=function(){if(!leftArrow.isDown&&s.vy===0){s.vx=0}};downArrow.press=function(){s.vy=speed;s.vx=0;s.direction="down"};downArrow.release=function(){if(!upArrow.isDown&&s.vx===0){s.vy=0}}};ga.makeTiledWorld=function(tiledMap,tileset){tiledMap=ga.json(tiledMap);var world=ga.group();world.tileheight=tiledMap.tileheight;world.tilewidth=tiledMap.tilewidth;world.width=tiledMap.width*tiledMap.tilewidth;world.height=tiledMap.height*tiledMap.tileheight;world.widthInTiles=tiledMap.width;world.heightInTiles=tiledMap.height;world.objects=[];var spacing=tiledMap.tilesets[0].spacing;var numberOfTilesetColumns=Math.floor(tiledMap.tilesets[0].imagewidth/(tiledMap.tilewidth+spacing));tiledMap.layers.forEach(function(tiledLayer){var layerGroup=ga.group();Object.keys(tiledLayer).forEach(function(key){if(key!=="width"&&key!=="height"){layerGroup[key]=tiledLayer[key]}});layerGroup.alpha=tiledLayer.opacity;world.addChild(layerGroup);world.objects.push(layerGroup);if(tiledLayer.type==="tilelayer"){tiledLayer.data.forEach(function(gid,index){var tileSprite,texture,mapX,mapY,tilesetX,tilesetY,mapColumn,mapRow,tilesetColumn,tilesetRow;if(gid!==0){mapColumn=index%world.widthInTiles;mapRow=Math.floor(index/world.widthInTiles);mapX=mapColumn*world.tilewidth;mapY=mapRow*world.tileheight;tilesetColumn=((gid-1)%numberOfTilesetColumns);tilesetRow=Math.floor((gid-1)/numberOfTilesetColumns);tilesetX=tilesetColumn*world.tilewidth;tilesetY=tilesetRow*world.tileheight;if(spacing>0){tilesetX+=spacing+(spacing*((gid-1)%numberOfTilesetColumns));tilesetY+=spacing+(spacing*Math.floor((gid-1)/numberOfTilesetColumns))}texture=ga.frame(tileset,tilesetX,tilesetY,world.tilewidth,world.tileheight);var tileproperties=tiledMap.tilesets[0].tileproperties,key=String(gid-1);if(tileproperties[key]&&tileproperties[key].name){tileSprite=ga.sprite(texture);Object.keys(tileproperties[key]).forEach(function(property){tileSprite[property]=tileproperties[key][property]});world.objects.push(tileSprite)}else{tileSprite=ga.sprite(texture)}tileSprite.x=mapX;tileSprite.y=mapY;tileSprite.index=index;tileSprite.gid=gid;layerGroup.addChild(tileSprite)}})}if(tiledLayer.type==="objectgroup"){tiledLayer.objects.forEach(function(object){object.group=layerGroup;layerGroup.width=world.width;layerGroup.height=world.height;world.objects.push(object)})}});world.getObject=function(objectName){this.searchForObject=function(){var foundObject;world.objects.some(function(object){if(object.name&&object.name===objectName){foundObject=object;
return true}});if(foundObject){return foundObject}else{console.log("There is no object with the property name: "+objectName)}};return this.searchForObject()};world.getObjects=function(namesOfObjects){var objectNames=Array.prototype.slice.call(arguments);var foundObjects=[];world.objects.forEach(function(object){if(object.name&&objectNames.indexOf(object.name)!==-1){foundObjects.push(object)}});if(foundObjects.length>0){return foundObjects}else{console.log("I could not find those objects")}return foundObjects};return world};ga.fullscreenScale=1;ga.requestFullScreen=function(){if(!document.fullscreenEnabled){ga.canvas.requestFullscreen()}};ga.exitFullScreen=function(){if(document.fullscreenEnabled){document.exitFullscreen()}};ga.alignFullscreen=function(){var scaleX,scaleY;scaleX=screen.width/ga.canvas.width;scaleY=screen.height/ga.canvas.height;ga.fullscreenScale=Math.min(scaleX,scaleY);var styleSheets=document.styleSheets;if(styleSheets.length===0){var divNode=document.createElement("div");divNode.innerHTML="<style></style>";document.body.appendChild(divNode)}var ua=navigator.userAgent.toLowerCase();if(ga.canvas.width>ga.canvas.height){if(ua.indexOf("safari")!==-1||ua.indexOf("chrome")!==-1){document.styleSheets[0].insertRule("canvas:-webkit-full-screen {position: fixed; width: 100%; height: auto; top: 0; right: 0; bottom: 0; left: 0; margin: auto; object-fit: contain}",0)}else{if(ua.indexOf("firefox")!==-1){document.styleSheets[0].insertRule("canvas:-moz-full-screen {position: fixed; width: 100%; height: auto; top: 0; right: 0; bottom: 0; left: 0; margin: auto; object-fit: contain;}",0)}else{if(ua.indexOf("opera")!==-1){document.styleSheets[0].insertRule("canvas:-o-full-screen {position: fixed; width: 100%; height: auto; top: 0; right: 0; bottom: 0; left: 0; margin: auto; object-fit: contain;}",0)}else{if(ua.indexOf("explorer")!==-1){document.styleSheets[0].insertRule("canvas:-ms-full-screen {position: fixed; width: 100%; height: auto; top: 0; right: 0; bottom: 0; left: 0; margin: auto; object-fit: contain;}",0)}else{document.styleSheets[0].insertRule("canvas:fullscreen {position: fixed; width: 100%; height: auto; top: 0; right: 0; bottom: 0; left: 0; margin: auto; object-fit: contain;}",0)}}}}}else{if(ua.indexOf("safari")!==-1||ua.indexOf("chrome")!==-1){document.styleSheets[0].insertRule("canvas:-webkit-full-screen {height: 100%; margin: 0 auto; object-fit: contain;}",0)}else{if(ua.indexOf("firefox")!==-1){document.styleSheets[0].insertRule("canvas:-moz-full-screen {height: 100%; margin: 0 auto; object-fit: contain;}",0)}else{if(ua.indexOf("opera")!==-1){document.styleSheets[0].insertRule("canvas:-o-full-screen {height: 100%; margin: 0 auto; object-fit: contain;}",0)}else{if(ua.indexOf("msie")!==-1){document.styleSheets[0].insertRule("canvas:-ms-full-screen {height: 100%; margin: 0 auto; object-fit: contain;}",0)}else{document.styleSheets[0].insertRule("canvas:fullscreen {height: 100%; margin: 0 auto; object-fit: contain;}",0)}}}}}};ga.enableFullscreen=function(exitKeyCodes){if(exitKeyCodes){exitKeyCodes=Array.prototype.slice.call(arguments)}ga.alignFullscreen();ga.canvas.addEventListener("mouseup",ga.requestFullScreen,false);ga.canvas.addEventListener("touchend",ga.requestFullScreen,false);if(exitKeyCodes){exitKeyCodes.forEach(function(keyCode){window.addEventListener("keyup",function(event){if(event.keyCode===keyCode){ga.exitFullScreen()}event.preventDefault()},false)})}};ga.launchFullscreen=function(sprite){if(ga.hitTestPoint(ga.pointer.position,sprite)){ga.enableFullscreen()}};ga.scaleFullscreen=function(){if(document.fullscreenEnabled){ga.scale=ga.fullscreenScale;ga.pointer.scale=ga.fullscreenScale}else{if(!ga.canvas.scaled){ga.scale=1;ga.pointer.scale=1}}};ga.updateFunctions.push(ga.scaleFullscreen);ga.actx=new AudioContext();ga.makeSound=function(source,loadHandler){var o={};var actx=ga.actx;o.volumeNode=ga.actx.createGain();if(!actx.createStereoPanner){o.panNode=actx.createPanner()}else{o.panNode=actx.createStereoPanner()}o.delayNode=actx.createDelay();o.feedbackNode=actx.createGain();o.filterNode=actx.createBiquadFilter();o.convolverNode=actx.createConvolver();o.soundNode=null;o.buffer=null;o.source=null;o.loop=false;o.playing=false;o.loadHandler=undefined;o.panValue=0;o.volumeValue=1;o.startTime=0;o.startOffset=0;o.playbackRate=1;o.echo=false;o.delayValue=0.3;o.feebackValue=0.3;o.filterValue=0;o.reverb=false;o.reverbImpulse=null;o.play=function(){o.startTime=actx.currentTime;o.soundNode=actx.createBufferSource();o.soundNode.buffer=o.buffer;o.soundNode.playbackRate.value=this.playbackRate;o.soundNode.connect(o.volumeNode);if(o.reverb===false){o.volumeNode.connect(o.panNode)}else{o.volumeNode.connect(o.convolverNode);o.convolverNode.connect(o.panNode);o.convolverNode.buffer=o.reverbImpulse}o.panNode.connect(actx.destination);if(o.echo){o.feedbackNode.gain.value=o.feebackValue;o.delayNode.delayTime.value=o.delayValue;o.filterNode.frequency.value=o.filterValue;o.delayNode.connect(o.feedbackNode);if(o.filterValue>0){o.feedbackNode.connect(o.filterNode);
o.filterNode.connect(o.delayNode)}else{o.feedbackNode.connect(o.delayNode)}o.volumeNode.connect(o.delayNode);o.delayNode.connect(o.panNode)}o.soundNode.loop=o.loop;o.soundNode.start(0,o.startOffset%o.buffer.duration);o.playing=true};o.pause=function(){if(o.playing){o.soundNode.stop(0);o.startOffset+=actx.currentTime-o.startTime;o.playing=false}};o.restart=function(){if(o.playing){o.soundNode.stop(0)}o.startOffset=0;o.play()};o.playFrom=function(value){if(o.playing){o.soundNode.stop(0)}o.startOffset=value;o.play()};o.setEcho=function(delayValue,feedbackValue,filterValue){if(delayValue===undefined){delayValue=0.3}if(feedbackValue===undefined){feedbackValue=0.3}if(filterValue===undefined){filterValue=0}o.delayValue=delayValue;o.feebackValue=feedbackValue;o.filterValue=filterValue;o.echo=true};o.setReverb=function(duration,decay,reverse){if(duration===undefined){duration=2}if(decay===undefined){decay=2}if(reverse===undefined){reverse=false}o.reverbImpulse=ga.impulseResponse(duration,decay,reverse,actx);o.reverb=true};o.fade=function(endValue,durationInSeconds){if(o.playing){o.volumeNode.gain.linearRampToValueAtTime(o.volumeNode.gain.value,actx.currentTime);o.volumeNode.gain.linearRampToValueAtTime(endValue,actx.currentTime+durationInSeconds)}};o.fadeIn=function(durationInSeconds){o.volumeNode.gain.value=0;o.fade(1,durationInSeconds)};o.fadeOut=function(durationInSeconds){o.fade(0,durationInSeconds)};Object.defineProperties(o,{volume:{get:function(){return o.volumeValue},set:function(value){o.volumeNode.gain.value=value;o.volumeValue=value},enumerable:true,configurable:true},pan:{get:function(){if(!actx.createStereoPanner){return o.panValue}else{return o.panNode.pan.value}},set:function(value){if(!actx.createStereoPanner){var x=value,y=0,z=1-Math.abs(x);o.panNode.setPosition(x,y,z);o.panValue=value}else{o.panNode.pan.value=value}},enumerable:true,configurable:true}});o.load=function(){var xhr=new XMLHttpRequest();xhr.open("GET",source,true);xhr.responseType="arraybuffer";xhr.addEventListener("load",function(){actx.decodeAudioData(xhr.response,function(buffer){o.buffer=buffer;o.hasLoaded=true;if(loadHandler){loadHandler()}},function(error){throw new Error("Audio could not be decoded: "+error)})});xhr.send()};o.load();return o};ga.sound=function(soundFileName){return ga.assets[soundFileName]};ga.soundEffect=function(frequencyValue,attack,decay,type,volumeValue,panValue,wait,pitchBendAmount,reverse,randomValue,dissonance,echo,reverb){if(frequencyValue===undefined){frequencyValue=200}if(attack===undefined){attack=0}if(decay===undefined){decay=1}if(type===undefined){type="sine"}if(volumeValue===undefined){volumeValue=1}if(panValue===undefined){panValue=0}if(wait===undefined){wait=0}if(pitchBendAmount===undefined){pitchBendAmount=0}if(reverse===undefined){reverse=false}if(randomValue===undefined){randomValue=0}if(dissonance===undefined){dissonance=0}if(echo===undefined){echo=undefined}if(reverb===undefined){reverb=undefined}var actx=ga.actx;var oscillator,volume,pan;oscillator=actx.createOscillator();volume=actx.createGain();if(!actx.createStereoPanner){pan=actx.createPanner()}else{pan=actx.createStereoPanner()}oscillator.connect(volume);volume.connect(pan);pan.connect(actx.destination);volume.gain.value=volumeValue;if(!actx.createStereoPanner){pan.setPosition(panValue,0,1-Math.abs(panValue))}else{pan.pan.value=panValue}oscillator.type=type;var frequency;var randomInt=function(min,max){return Math.floor(Math.random()*(max-min+1))+min};if(randomValue>0){frequency=randomInt(frequencyValue-randomValue/2,frequencyValue+randomValue/2)}else{frequency=frequencyValue}oscillator.frequency.value=frequency;if(attack>0){fadeIn(volume)}fadeOut(volume);if(pitchBendAmount>0){pitchBend(oscillator)}if(echo){addEcho(volume)}if(reverb){addReverb(volume)}if(dissonance>0){addDissonance()}play(oscillator);function addReverb(volumeNode){var convolver=actx.createConvolver();convolver.buffer=ga.impulseResponse(reverb[0],reverb[1],reverb[2],actx);volumeNode.connect(convolver);convolver.connect(pan)}function addEcho(volumeNode){var feedback=actx.createGain(),delay=actx.createDelay(),filter=actx.createBiquadFilter();delay.delayTime.value=echo[0];feedback.gain.value=echo[1];if(echo[2]){filter.frequency.value=echo[2]}delay.connect(feedback);if(echo[2]){feedback.connect(filter);filter.connect(delay)}else{feedback.connect(delay)}volumeNode.connect(delay);delay.connect(pan)}function fadeIn(volumeNode){volumeNode.gain.value=0;volumeNode.gain.linearRampToValueAtTime(0,actx.currentTime+wait);volumeNode.gain.linearRampToValueAtTime(volumeValue,actx.currentTime+wait+attack)}function fadeOut(volumeNode){volumeNode.gain.linearRampToValueAtTime(volumeValue,actx.currentTime+attack+wait);volumeNode.gain.linearRampToValueAtTime(0,actx.currentTime+wait+attack+decay)}function pitchBend(oscillatorNode){var frequency=oscillatorNode.frequency.value;if(!reverse){oscillatorNode.frequency.linearRampToValueAtTime(frequency,actx.currentTime+wait);oscillatorNode.frequency.linearRampToValueAtTime(frequency-pitchBendAmount,actx.currentTime+wait+attack+decay)
}else{oscillatorNode.frequency.linearRampToValueAtTime(frequency,actx.currentTime+wait);oscillatorNode.frequency.linearRampToValueAtTime(frequency+pitchBendAmount,actx.currentTime+wait+attack+decay)}}function addDissonance(){var d1=actx.createOscillator(),d2=actx.createOscillator(),d1Volume=actx.createGain(),d2Volume=actx.createGain();d1Volume.gain.value=volumeValue;d2Volume.gain.value=volumeValue;d1.connect(d1Volume);d1Volume.connect(actx.destination);d2.connect(d2Volume);d2Volume.connect(actx.destination);d1.type="sawtooth";d2.type="sawtooth";d1.frequency.value=frequency+dissonance;d2.frequency.value=frequency-dissonance;if(attack>0){fadeIn(d1Volume);fadeIn(d2Volume)}if(decay>0){fadeOut(d1Volume);fadeOut(d2Volume)}if(pitchBendAmount>0){pitchBend(d1);pitchBend(d2)}if(echo){addEcho(d1Volume);addEcho(d2Volume)}if(reverb){addReverb(d1Volume);addReverb(d2Volume)}play(d1);play(d2)}function play(node){node.start(actx.currentTime+wait)}};ga.impulseResponse=function(duration,decay,reverse,actx){var length=actx.sampleRate*duration;var impulse=actx.createBuffer(2,length,actx.sampleRate);var left=impulse.getChannelData(0),right=impulse.getChannelData(1);for(var i=0;i<length;i++){var n;if(reverse){n=length-i}else{n=i}left[i]=(Math.random()*2-1)*Math.pow(1-n/length,decay);right[i]=(Math.random()*2-1)*Math.pow(1-n/length,decay)}return impulse}};